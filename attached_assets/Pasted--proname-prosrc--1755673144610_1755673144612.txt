| proname                  | prosrc                                                                                                                                                                                                                                                                                                                                                                             |
| ------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| update_updated_at_column | 
BEGIN
    NEW.updated_at = now();
    RETURN NEW; 
END;
                                                                                                                                                                                                                                                                                                                          |
| sync_user_email          | 
BEGIN
  -- Get email from auth.users and set it in the profile
  SELECT email INTO NEW.email 
  FROM auth.users 
  WHERE id = NEW.user_id;
  
  RETURN NEW;
END;
                                                                                                                                                                                                                 |
| update_updated_at_column | 
BEGIN
    NEW.updated_at = NOW();
    RETURN NEW;
END;
                                                                                                                                                                                                                                                                                                                      |
| assign_default_package   | 
BEGIN
  -- Get the free package ID
  SELECT id INTO NEW.package_id 
  FROM indb_payment_packages 
  WHERE slug = 'free' 
  LIMIT 1;
  
  -- Set subscription details
  NEW.subscribed_at = CURRENT_TIMESTAMP;
  NEW.expires_at = NULL; -- Free plan never expires
  NEW.daily_quota_used = 0;
  NEW.daily_quota_reset_date = CURRENT_DATE;
  
  RETURN NEW;
END;
 |