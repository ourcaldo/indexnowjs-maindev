✅ SMTP transporter initialized and verified successfully
🚀 [Midtrans Recurring] Creating charge transaction with parameters: {
  order_id: 'ORDER-1756327837309-915f50e5',
  amount_usd: 45,
  token_id: '48111111-1114-e2676f...',
  customer_name: 'aldodkris ',
  customer_email: 'aldodkris@gmail.com'
}
💱 CURRENCY CONVERSION DEBUG:
  Input USD amount: 1
  Converted IDR amount: 16303
  Final gross amount (rounded): 16303
💳 [MIDTRANS SERVICE] Making direct charge request to /v2/charge with save_card: true
💳 [MIDTRANS SERVICE] Using token_id from frontend tokenization: 48111111-1114-e2676f84-6b91-4a84-af0b-241a9e8dfb34
📤 [MIDTRANS SERVICE] COMPLETE CHARGE REQUEST PAYLOAD: {
  "payment_type": "credit_card",
  "transaction_details": {
    "order_id": "ORDER-1756327837309-915f50e5",
    "gross_amount": 16303
  },
  "credit_card": {
    "token_id": "48111111-1114-e2676f84-6b91-4a84-af0b-241a9e8dfb34",
    "save_card": true,
    "authentication": true,
    "callback_type": "js_event"
  },
  "item_details": [
    {
      "id": "subscription_setup",
      "price": 16303,
      "quantity": 1,
      "name": "Pro - 3 Day Free Trial"
    }
  ],
  "customer_details": {
    "first_name": "aldodkris",
    "last_name": "",
    "email": "aldodkris@gmail.com",
    "phone": "081244001006",
    "billing_address": {
      "first_name": "aldodkris",
      "last_name": "",
      "email": "aldodkris@gmail.com",
      "phone": "081244001006",
      "address": "Jakarta",
      "city": "Jakarta",
      "postal_code": "12190",
      "country_code": "IDN"
    }
  }
}
🔗 Making POST request to: https://api.sandbox.midtrans.com/v2/charge
📤 Request body: {
  "payment_type": "credit_card",
  "transaction_details": {
    "order_id": "ORDER-1756327837309-915f50e5",
    "gross_amount": 16303
  },
  "credit_card": {
    "token_id": "48111111-1114-e2676f84-6b91-4a84-af0b-241a9e8dfb34",
    "save_card": true,
    "authentication": true,
    "callback_type": "js_event"
  },
  "item_details": [
    {
      "id": "subscription_setup",
      "price": 16303,
      "quantity": 1,
      "name": "Pro - 3 Day Free Trial"
    }
  ],
  "customer_details": {
    "first_name": "aldodkris",
    "last_name": "",
    "email": "aldodkris@gmail.com",
    "phone": "081244001006",
    "billing_address": {
      "first_name": "aldodkris",
      "last_name": "",
      "email": "aldodkris@gmail.com",
      "phone": "081244001006",
      "address": "Jakarta",
      "city": "Jakarta",
      "postal_code": "12190",
      "country_code": "IDN"
    }
  }
}
📥 Response (200): {
  "status_code": "201",
  "status_message": "Success, Credit Card transaction is successful",
  "transaction_id": "e2676f84-6b91-4a84-af0b-241a9e8dfb34",
  "order_id": "ORDER-1756327837309-915f50e5",
  "merchant_id": "G643888341",
  "gross_amount": "16303.00",
  "currency": "IDR",
  "payment_type": "credit_card",
  "transaction_time": "2025-08-28 03:50:38",
  "transaction_status": "pending",
  "fraud_status": "accept",
  "expiry_time": "2025-09-05 03:50:38",
  "bank": "bni",
  "redirect_url": "https://api.sandbox.midtrans.com/v2/3ds/redirect/e2676f84-6b91-4a84-af0b-241a9e8dfb34",
  "masked_card": "48111111-1114",
  "card_type": "credit",
  "channel": "dragon",
  "three_ds_version": "2",
  "on_us": false
}
📥 [MIDTRANS SERVICE] COMPLETE CHARGE RESPONSE FROM MIDTRANS: {
  "status_code": "201",
  "status_message": "Success, Credit Card transaction is successful",
  "transaction_id": "e2676f84-6b91-4a84-af0b-241a9e8dfb34",
  "order_id": "ORDER-1756327837309-915f50e5",
  "merchant_id": "G643888341",
  "gross_amount": "16303.00",
  "currency": "IDR",
  "payment_type": "credit_card",
  "transaction_time": "2025-08-28 03:50:38",
  "transaction_status": "pending",
  "fraud_status": "accept",
  "expiry_time": "2025-09-05 03:50:38",
  "bank": "bni",
  "redirect_url": "https://api.sandbox.midtrans.com/v2/3ds/redirect/e2676f84-6b91-4a84-af0b-241a9e8dfb34",
  "masked_card": "48111111-1114",
  "card_type": "credit",
  "channel": "dragon",
  "three_ds_version": "2",
  "on_us": false
}
📋 [Midtrans Recurring] COMPLETE CHARGE RESPONSE FROM MIDTRANS: {
  "status_code": "201",
  "status_message": "Success, Credit Card transaction is successful",
  "transaction_id": "e2676f84-6b91-4a84-af0b-241a9e8dfb34",
  "order_id": "ORDER-1756327837309-915f50e5",
  "merchant_id": "G643888341",
  "gross_amount": "16303.00",
  "currency": "IDR",
  "payment_type": "credit_card",
  "transaction_time": "2025-08-28 03:50:38",
  "transaction_status": "pending",
  "fraud_status": "accept",
  "expiry_time": "2025-09-05 03:50:38",
  "bank": "bni",
  "redirect_url": "https://api.sandbox.midtrans.com/v2/3ds/redirect/e2676f84-6b91-4a84-af0b-241a9e8dfb34",
  "masked_card": "48111111-1114",
  "card_type": "credit",
  "channel": "dragon",
  "three_ds_version": "2",
  "on_us": false
}
🔐 3DS Authentication required for transaction: {
  order_id: 'ORDER-1756327837309-915f50e5',
  transaction_id: 'e2676f84-6b91-4a84-af0b-241a9e8dfb34',
  redirect_url: 'https://api.sandbox.midtrans.com/v2/3ds/redirect/e2676f84-6b91-4a84-af0b-241a9e8dfb34',
  transaction_status: 'pending'
}
 POST /api/billing/payment 200 in 9212ms
 ○ Compiling /api/debug/payment-result ...
 ✓ Compiled /api/debug/payment-result in 1991ms (990 modules)
📋 [FRONTEND-TO-BACKEND] Payment result received by frontend: {
  payment_method: 'midtrans_recurring',
  result: '{\n' +
    '  "success": true,\n' +
    '  "data": {\n' +
    '    "order_id": "ORDER-1756327837309-915f50e5",\n' +
    '    "transaction_id": "e2676f84-6b91-4a84-af0b-241a9e8dfb34",\n' +
    '    "requires_3ds": true\n' +
    '  },\n' +
    '  "requires_redirect": true,\n' +
    '  "redirect_url": "https://api.sandbox.midtrans.com/v2/3ds/redirect/e2676f84-6b91-4a84-af0b-241a9e8dfb34"\n' +
    '}'
}
 POST /api/debug/payment-result 200 in 2145ms
 GET /api/billing/midtrans-config 200 in 646ms
🔧 Initializing SMTP transporter...
📧 SMTP Config: mail.indexnow.studio:465
👤 SMTP User: notifikasi@indexnow.studio
🚀 [Payment Router] Starting payment processing
📊 [Payment Router] Routing to channel: midtrans_recurring
✅ SMTP transporter initialized and verified successfully
🚀 [Midtrans Recurring] Creating charge transaction with parameters: {
  order_id: 'ORDER-1756327885326-915f50e5',
  amount_usd: 45,
  token_id: '48111111-1114-eb4f4e...',
  customer_name: 'aldodkris ',
  customer_email: 'aldodkris@gmail.com'
}
💱 CURRENCY CONVERSION DEBUG:
  Input USD amount: 1
  Converted IDR amount: 16303
  Final gross amount (rounded): 16303
💳 [MIDTRANS SERVICE] Making direct charge request to /v2/charge with save_card: true
💳 [MIDTRANS SERVICE] Using token_id from frontend tokenization: 48111111-1114-eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14
📤 [MIDTRANS SERVICE] COMPLETE CHARGE REQUEST PAYLOAD: {
  "payment_type": "credit_card",
  "transaction_details": {
    "order_id": "ORDER-1756327885326-915f50e5",
    "gross_amount": 16303
  },
  "credit_card": {
    "token_id": "48111111-1114-eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14",
    "save_card": true,
    "authentication": true,
    "callback_type": "js_event"
  },
  "item_details": [
    {
      "id": "subscription_setup",
      "price": 16303,
      "quantity": 1,
      "name": "Pro - 3 Day Free Trial"
    }
  ],
  "customer_details": {
    "first_name": "aldodkris",
    "last_name": "",
    "email": "aldodkris@gmail.com",
    "phone": "081244001006",
    "billing_address": {
      "first_name": "aldodkris",
      "last_name": "",
      "email": "aldodkris@gmail.com",
      "phone": "081244001006",
      "address": "Jakarta",
      "city": "Jakarta",
      "postal_code": "12190",
      "country_code": "IDN"
    }
  }
}
🔗 Making POST request to: https://api.sandbox.midtrans.com/v2/charge
📤 Request body: {
  "payment_type": "credit_card",
  "transaction_details": {
    "order_id": "ORDER-1756327885326-915f50e5",
    "gross_amount": 16303
  },
  "credit_card": {
    "token_id": "48111111-1114-eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14",
    "save_card": true,
    "authentication": true,
    "callback_type": "js_event"
  },
  "item_details": [
    {
      "id": "subscription_setup",
      "price": 16303,
      "quantity": 1,
      "name": "Pro - 3 Day Free Trial"
    }
  ],
  "customer_details": {
    "first_name": "aldodkris",
    "last_name": "",
    "email": "aldodkris@gmail.com",
    "phone": "081244001006",
    "billing_address": {
      "first_name": "aldodkris",
      "last_name": "",
      "email": "aldodkris@gmail.com",
      "phone": "081244001006",
      "address": "Jakarta",
      "city": "Jakarta",
      "postal_code": "12190",
      "country_code": "IDN"
    }
  }
}
📥 Response (200): {
  "status_code": "201",
  "status_message": "Success, Credit Card transaction is successful",
  "transaction_id": "eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14",
  "order_id": "ORDER-1756327885326-915f50e5",
  "merchant_id": "G643888341",
  "gross_amount": "16303.00",
  "currency": "IDR",
  "payment_type": "credit_card",
  "transaction_time": "2025-08-28 03:51:26",
  "transaction_status": "pending",
  "fraud_status": "accept",
  "expiry_time": "2025-09-05 03:51:26",
  "bank": "bni",
  "redirect_url": "https://api.sandbox.midtrans.com/v2/3ds/redirect/eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14",
  "masked_card": "48111111-1114",
  "card_type": "credit",
  "channel": "dragon",
  "three_ds_version": "2",
  "on_us": false
}
📥 [MIDTRANS SERVICE] COMPLETE CHARGE RESPONSE FROM MIDTRANS: {
  "status_code": "201",
  "status_message": "Success, Credit Card transaction is successful",
  "transaction_id": "eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14",
  "order_id": "ORDER-1756327885326-915f50e5",
  "merchant_id": "G643888341",
  "gross_amount": "16303.00",
  "currency": "IDR",
  "payment_type": "credit_card",
  "transaction_time": "2025-08-28 03:51:26",
  "transaction_status": "pending",
  "fraud_status": "accept",
  "expiry_time": "2025-09-05 03:51:26",
  "bank": "bni",
  "redirect_url": "https://api.sandbox.midtrans.com/v2/3ds/redirect/eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14",
  "masked_card": "48111111-1114",
  "card_type": "credit",
  "channel": "dragon",
  "three_ds_version": "2",
  "on_us": false
}
📋 [Midtrans Recurring] COMPLETE CHARGE RESPONSE FROM MIDTRANS: {
  "status_code": "201",
  "status_message": "Success, Credit Card transaction is successful",
  "transaction_id": "eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14",
  "order_id": "ORDER-1756327885326-915f50e5",
  "merchant_id": "G643888341",
  "gross_amount": "16303.00",
  "currency": "IDR",
  "payment_type": "credit_card",
  "transaction_time": "2025-08-28 03:51:26",
  "transaction_status": "pending",
  "fraud_status": "accept",
  "expiry_time": "2025-09-05 03:51:26",
  "bank": "bni",
  "redirect_url": "https://api.sandbox.midtrans.com/v2/3ds/redirect/eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14",
  "masked_card": "48111111-1114",
  "card_type": "credit",
  "channel": "dragon",
  "three_ds_version": "2",
  "on_us": false
}
🔐 3DS Authentication required for transaction: {
  order_id: 'ORDER-1756327885326-915f50e5',
  transaction_id: 'eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14',
  redirect_url: 'https://api.sandbox.midtrans.com/v2/3ds/redirect/eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14',
  transaction_status: 'pending'
}
 POST /api/billing/payment 200 in 3649ms
📋 [FRONTEND-TO-BACKEND] Payment result received by frontend: {
  payment_method: 'midtrans_recurring',
  result: '{\n' +
    '  "success": true,\n' +
    '  "data": {\n' +
    '    "order_id": "ORDER-1756327885326-915f50e5",\n' +
    '    "transaction_id": "eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14",\n' +
    '    "requires_3ds": true\n' +
    '  },\n' +
    '  "requires_redirect": true,\n' +
    '  "redirect_url": "https://api.sandbox.midtrans.com/v2/3ds/redirect/eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14"\n' +
    '}'
}
 POST /api/debug/payment-result 200 in 42ms
 ○ Compiling /api/billing/midtrans-3ds-callback ...
 ✓ Compiled /api/billing/midtrans-3ds-callback in 534ms (899 modules)

🔐 ============= 3DS AUTHENTICATION CALLBACK =============

🔐 ============= 3DS AUTHENTICATION CALLBACK =============
📋 3DS Callback received: {
  transaction_id: 'eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14',
  order_id: 'ORDER-1756327885326-915f50e5'
}
📋 3DS Callback received: {
  transaction_id: 'eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14',
  order_id: 'ORDER-1756327885326-915f50e5'
}
🔍 Checking transaction status after 3DS authentication
🔍 Getting transaction status for: eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14
🔗 Making GET request to: https://api.sandbox.midtrans.com/v2/eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14/status
🔍 Checking transaction status after 3DS authentication
🔍 Getting transaction status for: eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14
🔗 Making GET request to: https://api.sandbox.midtrans.com/v2/eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14/status
📥 Response (200): {
  "status_code": "200",
  "transaction_id": "eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14",
  "gross_amount": "16303.00",
  "currency": "IDR",
  "order_id": "ORDER-1756327885326-915f50e5",
  "payment_type": "credit_card",
  "signature_key": "b2aa6896e205058c0726a61a1f85de4ba3d2dba0564f9d1da87bf22bc2d3e588cba12b73272be67fa0d48a941bf8f846467781c701801374ab1b95429f492426",
  "transaction_status": "capture",
  "fraud_status": "accept",
  "status_message": "Success, Credit Card capture transaction is successful",
  "merchant_id": "G643888341",
  "transaction_time": "2025-08-28 03:51:26",
  "settlement_time": "2025-08-28 03:51:32",
  "expiry_time": "2025-09-05 03:51:26",
  "channel_response_code": "00",
  "channel_response_message": "Approved",
  "bank": "bni",
  "approval_code": "1756327892123",
  "masked_card": "48111111-1114",
  "card_type": "credit",
  "channel": "dragon",
  "three_ds_version": "2",
  "on_us": false,
  "challenge_completion": true,
  "eci": "05"
}
📋 Transaction status after 3DS: {
  transaction_status: 'capture',
  fraud_status: 'accept',
  status_code: '200',
  status_message: 'Success, Credit Card capture transaction is successful',
  has_saved_token: false
}
✅ 3DS Authentication successful, continuing with subscription creation
📥 Response (200): {
  "status_code": "200",
  "transaction_id": "eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14",
  "gross_amount": "16303.00",
  "currency": "IDR",
  "order_id": "ORDER-1756327885326-915f50e5",
  "payment_type": "credit_card",
  "signature_key": "b2aa6896e205058c0726a61a1f85de4ba3d2dba0564f9d1da87bf22bc2d3e588cba12b73272be67fa0d48a941bf8f846467781c701801374ab1b95429f492426",
  "transaction_status": "capture",
  "fraud_status": "accept",
  "status_message": "Success, Credit Card capture transaction is successful",
  "merchant_id": "G643888341",
  "transaction_time": "2025-08-28 03:51:26",
  "settlement_time": "2025-08-28 03:51:32",
  "expiry_time": "2025-09-05 03:51:26",
  "channel_response_code": "00",
  "channel_response_message": "Approved",
  "bank": "bni",
  "approval_code": "1756327892123",
  "masked_card": "48111111-1114",
  "card_type": "credit",
  "channel": "dragon",
  "three_ds_version": "2",
  "on_us": false,
  "challenge_completion": true,
  "eci": "05"
}
📋 Transaction status after 3DS: {
  transaction_status: 'capture',
  fraud_status: 'accept',
  status_code: '200',
  status_message: 'Success, Credit Card capture transaction is successful',
  has_saved_token: false
}
✅ 3DS Authentication successful, continuing with subscription creation
💾 ============= STEP 1: CREATING SUBSCRIPTION AFTER 3DS =============
🔍 Getting transaction status for: eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14
🔗 Making GET request to: https://api.sandbox.midtrans.com/v2/eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14/status
💾 ============= STEP 1: CREATING SUBSCRIPTION AFTER 3DS =============
🔍 Getting transaction status for: eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14
🔗 Making GET request to: https://api.sandbox.midtrans.com/v2/eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14/status
📥 Response (200): {
  "status_code": "200",
  "transaction_id": "eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14",
  "gross_amount": "16303.00",
  "currency": "IDR",
  "order_id": "ORDER-1756327885326-915f50e5",
  "payment_type": "credit_card",
  "signature_key": "b2aa6896e205058c0726a61a1f85de4ba3d2dba0564f9d1da87bf22bc2d3e588cba12b73272be67fa0d48a941bf8f846467781c701801374ab1b95429f492426",
  "transaction_status": "capture",
  "fraud_status": "accept",
  "status_message": "Success, Credit Card capture transaction is successful",
  "merchant_id": "G643888341",
  "transaction_time": "2025-08-28 03:51:26",
  "settlement_time": "2025-08-28 03:51:32",
  "expiry_time": "2025-09-05 03:51:26",
  "channel_response_code": "00",
  "channel_response_message": "Approved",
  "bank": "bni",
  "approval_code": "1756327892123",
  "masked_card": "48111111-1114",
  "card_type": "credit",
  "channel": "dragon",
  "three_ds_version": "2",
  "on_us": false,
  "challenge_completion": true,
  "eci": "05"
}
🔍 Midtrans transaction details customer_details: undefined
🔍 Full transactionDetails keys: [
  'status_code',
  'transaction_id',
  'gross_amount',
  'currency',
  'order_id',
  'payment_type',
  'signature_key',
  'transaction_status',
  'fraud_status',
  'status_message',
  'merchant_id',
  'transaction_time',
  'settlement_time',
  'expiry_time',
  'channel_response_code',
  'channel_response_message',
  'bank',
  'approval_code',
  'masked_card',
  'card_type',
  'channel',
  'three_ds_version',
  'on_us',
  'challenge_completion',
  'eci'
]
🔍 Customer name extraction attempts: {
  customer_details_first_name: undefined,
  customer_detail_first_name: undefined,
  billing_address_first_name: undefined,
  final_extracted_name: undefined
}
📦 Fetching all packages to determine which one matches transaction amount...
📥 Response (200): {
  "status_code": "200",
  "transaction_id": "eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14",
  "gross_amount": "16303.00",
  "currency": "IDR",
  "order_id": "ORDER-1756327885326-915f50e5",
  "payment_type": "credit_card",
  "signature_key": "b2aa6896e205058c0726a61a1f85de4ba3d2dba0564f9d1da87bf22bc2d3e588cba12b73272be67fa0d48a941bf8f846467781c701801374ab1b95429f492426",
  "transaction_status": "capture",
  "fraud_status": "accept",
  "status_message": "Success, Credit Card capture transaction is successful",
  "merchant_id": "G643888341",
  "transaction_time": "2025-08-28 03:51:26",
  "settlement_time": "2025-08-28 03:51:32",
  "expiry_time": "2025-09-05 03:51:26",
  "channel_response_code": "00",
  "channel_response_message": "Approved",
  "bank": "bni",
  "approval_code": "1756327892123",
  "masked_card": "48111111-1114",
  "card_type": "credit",
  "channel": "dragon",
  "three_ds_version": "2",
  "on_us": false,
  "challenge_completion": true,
  "eci": "05"
}
🔍 Midtrans transaction details customer_details: undefined
🔍 Full transactionDetails keys: [
  'status_code',
  'transaction_id',
  'gross_amount',
  'currency',
  'order_id',
  'payment_type',
  'signature_key',
  'transaction_status',
  'fraud_status',
  'status_message',
  'merchant_id',
  'transaction_time',
  'settlement_time',
  'expiry_time',
  'channel_response_code',
  'channel_response_message',
  'bank',
  'approval_code',
  'masked_card',
  'card_type',
  'channel',
  'three_ds_version',
  'on_us',
  'challenge_completion',
  'eci'
]
🔍 Customer name extraction attempts: {
  customer_details_first_name: undefined,
  customer_detail_first_name: undefined,
  billing_address_first_name: undefined,
  final_extracted_name: undefined
}
📦 Fetching all packages to determine which one matches transaction amount...
💰 Transaction amount analysis: { idr_amount: 16303, calculated_usd: 1 }
⚠️ Could not match transaction amount to package, using first active package
📦 Matched package: {
  id: 'bd86868e-0bf7-4787-8ff7-fd2b335a870d',
  name: 'Free',
  amount_usd: 1,
  billing_period: 'monthly'
}
💾 ============= STEP 2: CREATING SUBSCRIPTION =============
💰 Transaction amount analysis: { idr_amount: 16303, calculated_usd: 1 }
⚠️ Could not match transaction amount to package, using first active package
📦 Matched package: {
  id: 'bd86868e-0bf7-4787-8ff7-fd2b335a870d',
  name: 'Free',
  amount_usd: 1,
  billing_period: 'monthly'
}
💾 ============= STEP 2: CREATING SUBSCRIPTION =============
🔄 Creating subscription with saved_token_id: 48111111-1114-eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14
🔗 Making POST request to: https://api.sandbox.midtrans.com/v1/subscriptions
📤 Request body: {
  "name": "FREE_MONTHLY",
  "amount": "16303",
  "currency": "IDR",
  "payment_type": "credit_card",
  "token": "48111111-1114-eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14",
  "schedule": {
    "interval": 1,
    "interval_unit": "month",
    "max_interval": 12,
    "start_time": "2025-09-26 20:51:35 +0700"
  },
  "retry_schedule": {
    "interval": 1,
    "interval_unit": "day",
    "max_interval": 3
  },
  "metadata": {
    "user_id": "915f50e5-0902-466a-b1af-bdf19d789722",
    "package_id": "bd86868e-0bf7-4787-8ff7-fd2b335a870d",
    "billing_period": "monthly",
    "order_id": "ORDER-1756327885326-915f50e5",
    "original_transaction_id": "eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14"
  },
  "customer_details": {
    "first_name": "aldodkris",
    "last_name": "",
    "email": "aldodkris@gmail.com",
    "phone": "081244001006"
  }
}
🔄 Creating subscription with saved_token_id: 48111111-1114-eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14
🔗 Making POST request to: https://api.sandbox.midtrans.com/v1/subscriptions
📤 Request body: {
  "name": "FREE_MONTHLY",
  "amount": "16303",
  "currency": "IDR",
  "payment_type": "credit_card",
  "token": "48111111-1114-eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14",
  "schedule": {
    "interval": 1,
    "interval_unit": "month",
    "max_interval": 12,
    "start_time": "2025-09-26 20:51:35 +0700"
  },
  "retry_schedule": {
    "interval": 1,
    "interval_unit": "day",
    "max_interval": 3
  },
  "metadata": {
    "user_id": "915f50e5-0902-466a-b1af-bdf19d789722",
    "package_id": "bd86868e-0bf7-4787-8ff7-fd2b335a870d",
    "billing_period": "monthly",
    "order_id": "ORDER-1756327885326-915f50e5",
    "original_transaction_id": "eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14"
  },
  "customer_details": {
    "first_name": "aldodkris",
    "last_name": "",
    "email": "aldodkris@gmail.com",
    "phone": "081244001006"
  }
}
📥 Response (200): {
  "id": "da353209-05d1-4ee7-a78d-6d9b54281ea2",
  "name": "FREE_MONTHLY",
  "amount": "16303",
  "currency": "IDR",
  "created_at": "2025-08-28 03:51:35",
  "schedule": {
    "interval": 1,
    "current_interval": 0,
    "max_interval": 12,
    "interval_unit": "month",
    "start_time": "2025-09-26 20:51:35",
    "next_execution_at": "2025-09-26 20:51:35"
  },
  "status": "active",
  "token": "48111111-1114-eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14",
  "payment_type": "credit_card",
  "transaction_ids": [],
  "metadata": {
    "user_id": "915f50e5-0902-466a-b1af-bdf19d789722",
    "package_id": "bd86868e-0bf7-4787-8ff7-fd2b335a870d",
    "billing_period": "monthly",
    "order_id": "ORDER-1756327885326-915f50e5",
    "original_transaction_id": "eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14"
  },
  "customer_details": {
    "email": "aldodkris@gmail.com",
    "first_name": "aldodkris",
    "last_name": "",
    "phone": "081244001006"
  },
  "retry_schedule": {
    "interval_unit": "day",
    "max_interval": 3,
    "interval": 1
  }
}
✅ Subscription created successfully! {
  subscription_id: 'da353209-05d1-4ee7-a78d-6d9b54281ea2',
  name: 'FREE_MONTHLY',
  status: 'active',
  saved_token_id: '48111111-1114-eb4f4e...'
}
💾 ============= STEP 3: SAVING TO DATABASE TABLES =============
📝 Updating/creating transaction record in indb_payment_transactions...
📝 Updating existing pending transaction: 20475f58-54d0-4239-8cbe-9bc23cadb0a4
📥 Response (200): {
  "id": "9b35bb9d-8e72-4ba5-a884-38823550ddf0",
  "name": "FREE_MONTHLY",
  "amount": "16303",
  "currency": "IDR",
  "created_at": "2025-08-28 03:51:35",
  "schedule": {
    "interval": 1,
    "current_interval": 0,
    "max_interval": 12,
    "interval_unit": "month",
    "start_time": "2025-09-26 20:51:35",
    "next_execution_at": "2025-09-26 20:51:35"
  },
  "status": "active",
  "token": "48111111-1114-eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14",
  "payment_type": "credit_card",
  "transaction_ids": [],
  "metadata": {
    "user_id": "915f50e5-0902-466a-b1af-bdf19d789722",
    "package_id": "bd86868e-0bf7-4787-8ff7-fd2b335a870d",
    "billing_period": "monthly",
    "order_id": "ORDER-1756327885326-915f50e5",
    "original_transaction_id": "eb4f4e26-6cab-4ec3-9ba4-0d4143e3dd14"
  },
  "customer_details": {
    "email": "aldodkris@gmail.com",
    "first_name": "aldodkris",
    "last_name": "",
    "phone": "081244001006"
  },
  "retry_schedule": {
    "interval_unit": "day",
    "max_interval": 3,
    "interval": 1
  }
}
✅ Subscription created successfully! {
  subscription_id: '9b35bb9d-8e72-4ba5-a884-38823550ddf0',
  name: 'FREE_MONTHLY',
  status: 'active',
  saved_token_id: '48111111-1114-eb4f4e...'
}
💾 ============= STEP 3: SAVING TO DATABASE TABLES =============
📝 Updating/creating transaction record in indb_payment_transactions...
📝 Updating existing pending transaction: 20475f58-54d0-4239-8cbe-9bc23cadb0a4
✅ Transaction record created: 20475f58-54d0-4239-8cbe-9bc23cadb0a4
📝 Creating Midtrans record in indb_payment_midtrans...
✅ Transaction record created: 20475f58-54d0-4239-8cbe-9bc23cadb0a4
📝 Creating Midtrans record in indb_payment_midtrans...
✅ Midtrans data record created: 8d7ee03f-5dad-4c38-a6f0-4c800e3bf28b
👤 Updating user profile with package subscription...
✅ User profile updated successfully
🎉 ============= SUCCESS: 3DS PAYMENT & SUBSCRIPTION COMPLETED =============
✅ 3DS authentication and payment completed successfully
💾 All database records saved successfully: {
  transaction_id: '20475f58-54d0-4239-8cbe-9bc23cadb0a4',
  midtrans_record_id: '8d7ee03f-5dad-4c38-a6f0-4c800e3bf28b',
  subscription_id: '9b35bb9d-8e72-4ba5-a884-38823550ddf0',
  user_id: '915f50e5-0902-466a-b1af-bdf19d789722',
  package_id: 'bd86868e-0bf7-4787-8ff7-fd2b335a870d',
  billing_period: 'monthly'
}
 POST /api/billing/midtrans-3ds-callback 200 in 3611ms
✅ Midtrans data record created: e11b7e52-9158-4f0f-97d7-029cfd6a529f
👤 Updating user profile with package subscription...
✅ User profile updated successfully
🎉 ============= SUCCESS: 3DS PAYMENT & SUBSCRIPTION COMPLETED =============
✅ 3DS authentication and payment completed successfully
💾 All database records saved successfully: {
  transaction_id: '20475f58-54d0-4239-8cbe-9bc23cadb0a4',
  midtrans_record_id: 'e11b7e52-9158-4f0f-97d7-029cfd6a529f',
  subscription_id: 'da353209-05d1-4ee7-a78d-6d9b54281ea2',
  user_id: '915f50e5-0902-466a-b1af-bdf19d789722',
  package_id: 'bd86868e-0bf7-4787-8ff7-fd2b335a870d',
  billing_period: 'monthly'
}
 POST /api/billing/midtrans-3ds-callback 200 in 3843ms